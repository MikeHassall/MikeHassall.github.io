<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinosaur Number Line Bridge</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            background-color: #f0f4f8;
        }
        .font-bangers {
            font-family: 'Bangers', cursive;
        }
        .game-container {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
            width: 100%;
            background: linear-gradient(to bottom, #87ceeb 50%, #ff4500 50%);
        }
        .header {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            align-items: center;
            padding: 1rem;
            background-color: rgba(0,0,0,0.1);
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .header-item {
            text-align: center;
        }
        .lives-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }
        .life-dino {
            width: 40px;
            height: 40px;
            transform: scaleX(-1);
        }
        .game-world {
            position: relative;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .game-world::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        .number-line {
            display: flex;
            position: absolute;
            bottom: 40%; /* Position the bridge */
            left: 0;
            padding: 0 50vw; /* Add padding to center the start */
            align-items: flex-end;
        }
        .plank-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 15px; /* Gap between planks */
            flex-shrink: 0;
        }
        .plank {
            width: 80px;
            height: 80px; /* Changed from 150px */
            background-image: url('https://placehold.co/80x80/8B4513/FFFFFF'); /* Changed URL and removed text */
            background-size: cover;
            border-bottom: 10px solid #654321;
            border-radius: 5px;
            position: relative;
            z-index: 1;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .plank-number {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px black;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .plank-number.visible {
            opacity: 1;
        }
        .rope {
            position: absolute;
            top: 20px;
            left: -15px;
            width: 110px; /* 80px plank + 30px gap */
            height: 20px;
            background-color: #d2b48c;
            border: 2px solid #8b4513;
            z-index: 0;
        }
        #player {
            position: absolute;
            width: 60px;
            height: 60px;
            z-index: 10;
            transition: all 0.5s cubic-bezier(0.250, 0.250, 0.750, 0.750);
            bottom: calc(40% + 80px); /* On top of the plank, adjusted for new height */
        }
        .input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            background-color: rgba(0,0,0,0.1);
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            max-width: 90%;
        }
        .dino-selection {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            cursor: pointer;
        }
        .dino-option {
            width: 80px;
            height: 80px;
            transition: transform 0.2s;
        }
        .dino-option:hover {
            transform: scale(1.1);
        }
        .message-box {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffcc00;
            color: #333;
            padding: 1rem 2rem;
            border-radius: 1rem;
            font-size: 2rem;
            font-weight: bold;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.5s, top 0.5s;
            pointer-events: none;
        }
        .message-box.show {
            opacity: 1;
            top: 25%;
        }
    </style>
</head>
<body class="bg-gray-800">

    <!-- Character Selection Modal -->
    <div id="character-select-modal" class="modal">
        <div class="modal-content shadow-lg">
            <h1 class="text-4xl font-bangers text-gray-800">Choose Your Dinosaur!</h1>
            <div id="dino-choices" class="dino-selection justify-center">
                <!-- Dinosaur options will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal hidden">
        <div class="modal-content shadow-lg">
            <h1 class="text-6xl font-bangers text-red-600">Game Over!</h1>
            <p class="text-2xl mt-4">Your final score is: <span id="final-score" class="font-bold">0</span></p>
            <button id="play-again-btn" class="mt-6 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-2xl transition">Play Again</button>
        </div>
    </div>

    <!-- Main Game Structure -->
    <div id="game-container" class="game-container hidden">
        <!-- Header -->
        <header class="header text-2xl font-bangers">
            <div class="header-item">
                <p>Score: <span id="score">0</span></p>
            </div>
            <div class="header-item">
                <p>Lives:</p>
                <div id="lives" class="lives-container"></div>
            </div>
            <div class="header-item">
                <p>Target: <span id="target-number">?</span></p>
            </div>
            <div class="header-item">
                <p>Time: <span id="timer">10</span></p>
            </div>
        </header>

        <!-- Game World -->
        <main class="game-world" id="game-world">
            <div class="number-line" id="number-line">
                <!-- Planks will be generated by JS -->
            </div>
            <div id="player">
                <!-- Player SVG will be here -->
            </div>
            <div id="message-box" class="message-box font-bangers"></div>
        </main>

        <!-- Input Area -->
        <footer class="input-area">
            <p class="text-white text-xl mr-4">Jump by:</p>
            <input type="number" id="jump-input" class="text-center w-24 p-2 rounded-lg text-xl" placeholder="e.g. 3">
            <button id="jump-btn-positive" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg ml-2 text-xl transition">Jump +</button>
            <button id="jump-btn-negative" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg ml-2 text-xl transition">Jump -</button>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const gameContainer = document.getElementById('game-container');
            const characterSelectModal = document.getElementById('character-select-modal');
            const dinoChoicesContainer = document.getElementById('dino-choices');
            const gameOverModal = document.getElementById('game-over-modal');
            const numberLine = document.getElementById('number-line');
            const playerElement = document.getElementById('player');
            const gameWorld = document.getElementById('game-world');
            const scoreElement = document.getElementById('score');
            const livesContainer = document.getElementById('lives');
            const targetNumberElement = document.getElementById('target-number');
            const timerElement = document.getElementById('timer');
            const jumpInput = document.getElementById('jump-input');
            const jumpBtnPositive = document.getElementById('jump-btn-positive');
            const jumpBtnNegative = document.getElementById('jump-btn-negative');
            const playAgainBtn = document.getElementById('play-again-btn');
            const finalScoreElement = document.getElementById('final-score');
            const messageBox = document.getElementById('message-box');

            // --- Game State ---
            let score = 0;
            let lives = 5;
            let currentPosition = 0;
            let targetNumber = 0;
            let timer = 10;
            let timerInterval;
            let isJumping = false;
            let chosenDino;

            // --- Game Constants ---
            const MIN_NUMBER = -20;
            const MAX_NUMBER = 20;
            const PLANK_WIDTH = 80;
            const GAP_WIDTH = 30;
            const PLANK_TOTAL_WIDTH = PLANK_WIDTH + GAP_WIDTH;
            const MAX_JUMP = 5.5;
            const DINOSAURS = {
                't-rex': {
                    standing: `<svg viewBox="0 0 24 24" fill="#22c55e"><path d="M16.5 8c0-1.5-1.2-2.7-2.7-2.7s-2.7 1.2-2.7 2.7c0 .4.1.8.3 1.1L9 12v5h2v-3l2.5-2.5c.3.2.7.3 1 .3 1.5 0 2.7-1.2 2.7-2.7zM6 17h12v2H6z"/></svg>`,
                    jumping: `<svg viewBox="0 0 24 24" fill="#22c55e"><path d="M16.5 6c0-1.5-1.2-2.7-2.7-2.7s-2.7 1.2-2.7 2.7c0 .4.1.8.3 1.1l-3.1 3.1 1.4 1.4 2.9-2.9c.3.2.7.3 1 .3 1.5 0 2.7-1.2 2.7-2.7zM6 17h12v2H6z"/></svg>`
                },
                'stego': {
                    standing: `<svg viewBox="0 0 24 24" fill="#3b82f6"><path d="M2 15h11l-2-3h-2l-2 3H2zm19-3h-5l2-4h3l-2 4zm-9 3v2H3v-2h9zm10 0v2h-8v-2h8zM12 4l-2 4h4l-2-4z"/></svg>`,
                    jumping: `<svg viewBox="0 0 24 24" fill="#3b82f6"><path d="M2 13h11l-2-3h-2l-2 3H2zm19-3h-5l2-4h3l-2 4zm-9 5v2H3v-2h9zm10 0v2h-8v-2h8zM12 2l-2 4h4l-2-4z"/></svg>`
                },
                'ptero': {
                    standing: `<svg viewBox="0 0 24 24" fill="#ef4444"><path d="M12 2L2 12h5v8h10v-8h5L12 2z"/></svg>`,
                    jumping: `<svg viewBox="0 0 24 24" fill="#ef4444"><path d="M12 2L2 12h5v8h10v-8h5L12 2z" transform="rotate(15 12 12)"/></svg>`
                },
                'bronto': {
                    standing: `<svg viewBox="0 0 24 24" fill="#eab308"><path d="M17 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-5-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM7 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM12 16c-2.21 0-4-1.79-4-4h8c0 2.21-1.79 4-4 4z"/></svg>`,
                    jumping: `<svg viewBox="0 0 24 24" fill="#eab308"><path d="M17 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-5-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM7 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM12 14c-2.21 0-4-1.79-4-4h8c0 2.21-1.79 4-4 4z"/></svg>`
                },
                'tricera': {
                    standing: `<svg viewBox="0 0 24 24" fill="#a855f7"><path d="M12 2L4 6v12h16V6l-8-4zm-2 14H6v-2h4v2zm0-4H6v-2h4v2zm0-4H6V6h4v2zm6 8h-4v-2h4v2zm0-4h-4v-2h4v2zm0-4h-4V6h4v2z"/></svg>`,
                    jumping: `<svg viewBox="0 0 24 24" fill="#a855f7"><path d="M12 2L4 6v12h16V6l-8-4zm-2 14H6v-2h4v2zm0-4H6v-2h4v2zm0-4H6V6h4v2zm6 8h-4v-2h4v2zm0-4h-4v-2h4v2zm0-4h-4V6h4v2z" transform="rotate(-10 12 12)"/></svg>`
                }
            };

            // --- Initialization ---
            function init() {
                setupCharacterSelection();
            }

            function setupCharacterSelection() {
                dinoChoicesContainer.innerHTML = '';
                Object.keys(DINOSAURS).forEach(key => {
                    const dinoOption = document.createElement('div');
                    dinoOption.classList.add('dino-option');
                    dinoOption.innerHTML = DINOSAURS[key].standing;
                    dinoOption.dataset.dino = key;
                    dinoOption.addEventListener('click', () => selectCharacter(key));
                    dinoChoicesContainer.appendChild(dinoOption);
                });
            }

            function selectCharacter(dinoKey) {
                chosenDino = DINOSAURS[dinoKey];
                playerElement.innerHTML = chosenDino.standing;
                characterSelectModal.classList.add('hidden');
                startGame();
            }

            function startGame() {
                gameContainer.classList.remove('hidden');
                resetGame();
                gameLoop();
            }
            
            function resetGame() {
                score = 0;
                lives = 5;
                currentPosition = 0;
                isJumping = false;
                gameOverModal.classList.add('hidden');
                updateScore();
                updateLives();
                createNumberLine();
                positionPlayer(0, false);
            }

            function createNumberLine() {
                numberLine.innerHTML = '';
                for (let i = MIN_NUMBER; i <= MAX_NUMBER; i++) {
                    const plankContainer = document.createElement('div');
                    plankContainer.className = 'plank-container';

                    // Add ropes, but not for the first plank
                    if (i > MIN_NUMBER) {
                        const rope = document.createElement('div');
                        rope.className = 'rope';
                        plankContainer.appendChild(rope);
                    }

                    const plank = document.createElement('div');
                    plank.className = 'plank';
                    plank.id = `plank-${i}`;
                    plank.dataset.number = i;

                    const plankNumber = document.createElement('span');
                    plankNumber.className = 'plank-number';
                    plankNumber.textContent = i;
                    
                    plank.appendChild(plankNumber);
                    plankContainer.appendChild(plank);
                    numberLine.appendChild(plankContainer);
                }
            }
            
            // --- Game Loop ---
            function gameLoop() {
                if (lives <= 0) {
                    endGame();
                    return;
                }
                isJumping = false;
                jumpInput.disabled = true;
                jumpBtnPositive.disabled = true;
                jumpBtnNegative.disabled = true;
                jumpInput.value = '';
                targetNumberElement.textContent = '?';

                showPlankNumbers(true);
                
                setTimeout(() => {
                    showPlankNumbers(false);
                    generateTarget();
                    startTimer();
                }, 5000); // Show numbers for 5 seconds
            }

            function showPlankNumbers(visible) {
                document.querySelectorAll('.plank-number').forEach(num => {
                    if (visible) {
                        num.classList.add('visible');
                    } else {
                        // When hiding numbers, check if it's the current plank
                        const plankOfThisNumber = num.closest('.plank');
                        if (plankOfThisNumber) {
                            const plankNumValue = parseInt(plankOfThisNumber.dataset.number, 10);
                            if (plankNumValue !== currentPosition) {
                                num.classList.remove('visible');
                            }
                        }
                    }
                });
            }

            function generateTarget() {
                let offset;
                do {
                    offset = Math.floor(Math.random() * 11) - 5; // -5 to +5
                } while (offset === 0); // Ensure there's always a jump
                
                targetNumber = currentPosition + offset;

                // Clamp target to be within bounds
                targetNumber = Math.max(MIN_NUMBER, Math.min(MAX_NUMBER, targetNumber));
                
                targetNumberElement.textContent = targetNumber;
                jumpInput.disabled = false;
                jumpBtnPositive.disabled = false;
                jumpBtnNegative.disabled = false;
                jumpInput.focus();
            }

            function startTimer() {
                timer = 10;
                timerElement.textContent = timer;
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timer--;
                    timerElement.textContent = timer;
                    if (timer <= 0) {
                        clearInterval(timerInterval);
                        handleIncorrectJump(currentPosition, "Time's Up!");
                    }
                }, 1000);
            }

            // --- Player Actions & Movement ---
            function handleJump(direction) {
                if (isJumping) return;
                
                const jumpValueStr = jumpInput.value;
                if (!jumpValueStr) {
                    showMessage("Enter a number!");
                    return;
                }

                const jumpValue = parseFloat(jumpValueStr) * direction;

                if (Math.abs(jumpValue) > MAX_JUMP) {
                    showMessage(`Max jump is ${MAX_JUMP}!`);
                    return;
                }

                isJumping = true;
                clearInterval(timerInterval);
                const destination = currentPosition + jumpValue;
                
                // Animate jump
                playerElement.innerHTML = chosenDino.jumping;
                if ((direction > 0 && playerElement.style.transform !== 'scaleX(1)') || (direction < 0 && playerElement.style.transform !== 'scaleX(-1)')) {
                     playerElement.style.transform = `scaleX(${direction > 0 ? 1 : -1})`;
                }

                // Find the closest plank
                const landedPlank = Math.round(destination);
                
                positionPlayer(destination, true);

                setTimeout(() => {
                    playerElement.innerHTML = chosenDino.standing;
                    // Check landing
                    if (landedPlank === targetNumber) {
                        handleCorrectJump();
                    } else {
                        // Check if it was a gap fall or wrong plank
                        if (Math.abs(destination - landedPlank) > 0.4) { // Fell in a gap
                           handleIncorrectJump(landedPlank, "Missed the plank!");
                        } else { // Landed on wrong plank
                           handleIncorrectJump(landedPlank, "Wrong plank!");
                        }
                    }
                }, 500); // Corresponds to jump animation time
            }
            
            function handleCorrectJump() {
                const points = timer;
                score += points;
                updateScore();
                showMessage(`Correct! +${points} points!`, 'success');
                currentPosition = targetNumber;
                // No need to call positionPlayer again, already there
                setTimeout(gameLoop, 2000);
            }

            function handleIncorrectJump(landedPlank, message) {
                lives--;
                updateLives();
                showMessage(message, 'error');

                const plankElement = document.getElementById(`plank-${landedPlank}`);
                if (plankElement && message === "Wrong plank!") {
                    // Break the plank
                    plankElement.style.transform = 'rotate(20deg) translateY(400px)';
                    plankElement.style.opacity = '0';
                }

                // Fall into lava
                const currentLeft = playerElement.style.left;
                playerElement.style.left = currentLeft;
                playerElement.style.bottom = '-100px'; // Fall down

                setTimeout(() => {
                    // Respawn on the correct plank
                    currentPosition = targetNumber;
                    positionPlayer(currentPosition, false);
                    
                    // Restore broken plank if it exists
                    if (plankElement) {
                        setTimeout(() => {
                            plankElement.style.transform = 'none';
                            plankElement.style.opacity = '1';
                        }, 500);
                    }

                    if (lives > 0) {
                        setTimeout(gameLoop, 1500);
                    } else {
                        endGame();
                    }
                }, 1000);
            }

            function positionPlayer(boardPosition, isAnimating) {
                // Calculate the center of the target plank.
                // We must account for the 50vw left padding on the number-line container.
                const paddingOffset = window.innerWidth / 2;
                const zeroIndexOffset = -MIN_NUMBER;
                const targetIndex = boardPosition + zeroIndexOffset;
                const targetLeft = paddingOffset + (targetIndex * PLANK_TOTAL_WIDTH) + (PLANK_WIDTH / 2) - (playerElement.offsetWidth / 2);

                if (isAnimating) {
                    playerElement.style.bottom = `calc(40% + 80px + 100px)`; // Jump up, adjusted for new height
                }
                
                playerElement.style.left = `${targetLeft}px`;

                // Scroll the world to keep player centered
                const worldScrollLeft = targetLeft - (gameWorld.offsetWidth / 2);
                gameWorld.scrollTo({
                    left: worldScrollLeft,
                    behavior: 'smooth'
                });

                if (isAnimating) {
                    setTimeout(() => {
                         playerElement.style.bottom = `calc(40% + 80px)`; // Land, adjusted for new height
                    }, 250);
                }
            }

            // --- UI Updates ---
            function updateScore() {
                scoreElement.textContent = score;
            }

            function updateLives() {
                livesContainer.innerHTML = '';
                for (let i = 0; i < lives; i++) {
                    const life = document.createElement('div');
                    life.className = 'life-dino';
                    life.innerHTML = chosenDino.standing;
                    livesContainer.appendChild(life);
                }
            }
            
            function showMessage(text, type = 'info') {
                messageBox.textContent = text;
                messageBox.classList.add('show');
                messageBox.style.backgroundColor = type === 'error' ? '#ef4444' : (type === 'success' ? '#22c55e' : '#eab308');

                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 1500);
            }

            // --- Game Over & Restart ---
            function endGame() {
                finalScoreElement.textContent = score;
                gameOverModal.classList.remove('hidden');
            }

            playAgainBtn.addEventListener('click', () => {
                gameOverModal.classList.add('hidden');
                gameContainer.classList.add('hidden');
                characterSelectModal.classList.remove('hidden');
                init();
            });
            
            jumpBtnPositive.addEventListener('click', () => handleJump(1));
            jumpBtnNegative.addEventListener('click', () => handleJump(-1));
            jumpInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    // Determine direction based on target
                    const jumpValue = parseFloat(jumpInput.value);
                    if (isNaN(jumpValue)) return;
                    const direction = (targetNumber > currentPosition) ? 1 : -1;
                    handleJump(direction);
                }
            });

            // --- Start the process ---
            init();
        });
    </script>
</body>
</html>
